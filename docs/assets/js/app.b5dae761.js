(function(e){function t(t){for(var s,i,r=t[0],l=t[1],c=t[2],u=0,h=[];u<r.length;u++)i=r[u],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&h.push(o[i][0]),o[i]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);d&&d(t);while(h.length)h.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],s=!0,r=1;r<a.length;r++){var l=a[r];0!==o[l]&&(s=!1)}s&&(n.splice(t--,1),e=i(i.s=a[0]))}return e}var s={},o={app:0},n=[];function i(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=s,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(a,s,function(t){return e[t]}.bind(null,s));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var d=l;n.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var s=a("64a9"),o=a.n(s);o.a},"56d7":function(e,t,a){"use strict";a.r(t);var s=a("a026"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("div",[a("b-navbar",{staticClass:"nav-bg",attrs:{toggleable:"lg",type:"dark"}},[a("b-navbar-brand",{attrs:{href:"#"}},[e._v("Vue Camera")]),a("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),a("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[a("b-navbar-nav",[a("b-nav-item",{attrs:{to:"/"}},[e._v("Camera")]),a("b-nav-item",{attrs:{to:"/gallery",disabled:0===e.cloudname.length||0===e.preset.length}},[e._v("Gallery")])],1),a("b-navbar-nav",{staticClass:"ml-auto"},[a("b-nav-item",[a("div",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-prevent-closing",modifiers:{"modal-prevent-closing":!0}}],staticClass:"settings"},[a("i",{staticClass:"fas fa-cog"})]),a("b-modal",{ref:"modal",attrs:{id:"modal-prevent-closing",title:"Cloudinary Upload Info"},on:{show:e.resetModal,hidden:e.resetModal,ok:e.handleOk}},[a("form",{ref:"form",on:{submit:function(t){return t.stopPropagation(),t.preventDefault(),e.handleSubmit(t)}}},[a("b-form-group",{attrs:{state:e.cloudnameState,label:"Cloudname","label-for":"cloud-name-input","invalid-feedback":"Cloudname is required"}},[a("b-form-input",{attrs:{id:"cloud-name-input",state:e.cloudnameState,required:""},model:{value:e.cloudname,callback:function(t){e.cloudname=t},expression:"cloudname"}})],1),a("b-form-group",{attrs:{state:e.presetState,label:"Preset","label-for":"preset-input","invalid-feedback":"Preset is required"}},[a("b-form-input",{attrs:{id:"preset-input",state:e.presetState,required:""},model:{value:e.preset,callback:function(t){e.preset=t},expression:"preset"}})],1),a("b-form-group",[a("b-form-checkbox",{attrs:{id:"clearsettings",name:"clearsettings",value:"true","unchecked-value":"false"},model:{value:e.clearsettings,callback:function(t){e.clearsettings=t},expression:"clearsettings"}},[e._v("Clear Settings")])],1)],1)])],1)],1)],1)],1)],1),a("b-container",[a("b-row",{staticClass:"routes"},[a("b-col",{attrs:{sm:"12"}},[a("router-view")],1)],1)],1)],1)},n=[],i=a("2f62"),r={name:"app",created:function(){console.log("App created",this.cloudname,this.preset),this.$ls.get("cloudname")&&(this.cloudname=this.$ls.get("cloudname")),this.$ls.get("preset")&&(this.preset=this.$ls.get("preset"))},data(){return{cloudnameState:null,presetState:null,clearsettings:"false",expire:36e5}},computed:{cloudname:{get(){return this.$store.state.settings.cloudname},set(e){this.$store.commit("updateCloudname",e)}},preset:{get(){return this.$store.state.settings.preset},set(e){this.$store.commit("updatePreset",e)}}},methods:{checkFormValidity(){return!!(this.cloudname&&this.cloudname.length>0&&this.preset&&this.preset.length>0)||(this.$bvToast.toast("Enter cloudname and preset to complete form save.",{title:"Settings",autoHideDelay:5e3,appendToast:!1}),!1)},resetModal(){this.cloudnameState=null,this.presetState=null},handleOk(e){e.preventDefault(),this.handleSubmit()},handleSubmit(){if("true"===this.clearsettings)return this.cloudname="",this.preset="",this.clearsettings="false",this.$ls.clear(),void this.$nextTick(()=>{this.$refs.modal.hide()});this.checkFormValidity()?(this.$ls.set("cloudname",this.cloudname,this.expire),this.$ls.set("preset",this.preset,this.expire),this.$nextTick(()=>{this.$refs.modal.hide()})):console.log("settings data not valid")}}},l=r,c=(a("034f"),a("2877")),d=Object(c["a"])(l,o,n,!1,null,null,null),u=d.exports,h=a("8c4f"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("camera")],1)},m=[],v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"camera"},[a("b-row",[a("b-col",{attrs:{sm:"12"}},[a("div",{staticClass:"actions"},[a("b-button-group",[e.cameraState?e._e():a("b-button",{attrs:{disabled:e.isStartEnabled},on:{click:e.start}},[e._v("Camera")]),e.cameraState?a("b-button",{attrs:{disabled:e.isStartEnabled},on:{click:e.stop}},[e._v("Stop")]):e._e(),e.cameraState?a("b-button",{attrs:{disabled:e.isStartEnabled},on:{click:e.snapshot}},[e._v("Snapsot")]):e._e(),e.isPhoto?a("b-button",{attrs:{disabled:!e.isPhoto},on:{click:e.download}},[e._v("Download")]):e._e(),e.isPhoto?a("div",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}]},[e.isPhoto?a("b-button",{attrs:{disabled:!e.isPhoto||0===e.settings.cloudname.length||0===e.settings.preset.length},on:{click:e.upload}},[e._v("Upload")]):e._e()],1):e._e()],1)],1)])],1),a("b-row",[a("b-col",{attrs:{sm:"12"}},[a("form",{},[a("b-form-select",{attrs:{options:e.options,size:"sm"},on:{change:function(t){return e.deviceChange()}},model:{value:e.selectedDevice,callback:function(t){e.selectedDevice=t},expression:"selectedDevice"}})],1)])],1),a("b-row",[a("b-col",{attrs:{sm:"12"}},[a("div",[a("video",{directives:[{name:"show",rawName:"v-show",value:e.cameraState,expression:"cameraState"}],attrs:{playsinline:"",autoplay:""}}),a("canvas",{directives:[{name:"show",rawName:"v-show",value:!e.cameraState,expression:"!cameraState"}]})])])],1)],1)},g=[],f=a("bc3a"),b=a.n(f);async function y(e,t,a){try{let s=new FormData,o=`https://api.cloudinary.com/v1_1/${e}/image/upload`;console.log(o),s.append("upload_preset",t),s.append("tags","browser_upload"),s.append("file",a);let n=await b()({method:"post",url:o,data:s});return await n.data}catch(s){throw console.log("error upload:",s),s}}var w={name:"Camera",data(){return{video:null,canvas:null,fileData:null,isStartEnabled:!0,isPhoto:!1,stream:null,currentStream:null,devices:[],options:[],constraints:{},selectedDevice:null,cameraState:!0}},computed:Object(i["b"])(["settings"]),methods:{upload:function(){if(console.log("upload"),0===this.settings.cloudname.length||0===this.settings.preset.length)return console.log("error: upload missing cloudname or preset"),void this.$bvToast.toast("Upload to Cloudinary unsuccessful: use settings to provide cloudname and preset",{title:"Cloudinary Upload",autoHideDelay:5e3,appendToast:!1});y(this.settings.cloudname,this.settings.preset,this.fileData).then(e=>{console.log(e),this.$bvToast.toast("Upload to Cloudinary successful",{title:"Cloudinary Upload",autoHideDelay:5e3,appendToast:!1})}).catch(e=>{this.$bvToast.toast("Upload to Cloudinary unsuccessful. Check settings.",{title:"Cloudinary Upload",autoHideDelay:5e3,appendToast:!1})})},snapshot:function(){console.log("snapshot"),this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight,this.canvas.getContext("2d").drawImage(this.video,0,0,this.canvas.width,this.canvas.height),this.fileData=this.canvas.toDataURL("image/jpeg"),this.isPhoto=!0,this.cameraState=!1},stop:function(){console.log("stop"),this.video.pause(),this.currentStream&&(this.currentStream.getTracks().forEach(e=>{e.stop()}),this.video.srcObject=null),this.video.removeAttribute("src"),this.video.load(),this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.isPhoto=!1,this.cameraState=!1,console.log("end stop",this.cameraState)},start:function(){console.log("start"),this.stop(),this.selectedDevice=this.options[0].value,this.getMedia().then(e=>{this.isStartEnabled=!1,this.cameraState=!0})},download:function(){if(console.log("downlaod"),this.fileData){console.log("download"),this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight,this.canvas.getContext("2d").drawImage(this.video,0,0,this.canvas.width,this.canvas.height);let e=document.createElement("a");e.href=this.fileData,e.textContent="photo",e.target="_blank",e.download="photo.jpeg",document.querySelector("body").append(e),e.click()}},getMedia:async function(){try{return this.stream=await navigator.mediaDevices.getUserMedia(this.constraints),window.stream=this.stream,this.currentStream=stream,this.video.srcObject=stream,!0}catch(e){throw e}},deviceChange:function(){this.stop(),this.setConstraints(),this.getMedia().then(e=>{this.isStartEnabled=!1,this.cameraState=!0})},setConstraints:function(){const e={};null===this.selectedDevice?e.facingMode="environment":e.deviceId={exact:this.selectedDevice},this.constraints={video:e,audio:!1}},getDevices:async function(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return console.log("enumerateDevices() not supported."),!1;try{let e=await navigator.mediaDevices.enumerateDevices();for(let t of e)if("videoinput"===t.kind){let e={};e.text=t.label,e.value=t.deviceId,this.options.push(e),this.devices.push(t)}return!0}catch(e){throw console.log("getDevices",e),e}console.log("devices",this.devices)}},mounted(){console.log("camera mounted cloudname",this.settings.cloudname),this.canvas=document.querySelector("canvas"),this.video=document.querySelector("video"),this.getDevices().then(e=>{this.selectedDevice=this.options[0].value,this.setConstraints()}).then(e=>{this.getMedia().then(e=>{this.isStartEnabled=!1})})}},S=w,_=(a("f5b4"),Object(c["a"])(S,v,g,!1,null,"314a2b28",null)),C=_.exports,D={name:"Home",data(){return{}},components:{camera:C}},$=D,k=Object(c["a"])($,p,m,!1,null,null,null),x=k.exports,O=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},P=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"gallery"}},[a("h2",[e._v("Gallery")]),a("section",{attrs:{id:"images"}})])}],j={name:"gallery",mounted(){this.$ls.get("cloudname")&&(this.cloudname=this.$ls.get("cloudname")),this.$ls.get("preset")&&(this.preset=this.$ls.get("preset")),this.myGallery=cloudinary.galleryWidget({container:"#images",cloudName:this.cloudname,mediaAssets:[{tag:"browser_upload"}]}),this.myGallery.render()},beforeDestroy:function(){this.myGallery.destroy},data(){return{myGallery:null}},computed:{cloudname:{get(){return this.$store.state.settings.cloudname},set(e){this.$store.commit("updateCloudname",e)}}}},E=j,T=a("ed39"),M=a.n(T),U=Object(c["a"])(E,O,P,!1,null,null,null);"function"===typeof M.a&&M()(U);var q=U.exports;s["default"].use(h["a"]);var H=new h["a"]({routes:[{path:"/",name:"home",component:x},{path:"/gallery",name:"gallery",component:q}]});s["default"].use(i["a"]);const G=new i["a"].Store({state:{settings:{cloudname:"",preset:""}},mutations:{updateCloudname(e,t){e.settings.cloudname=t},updatePreset(e,t){e.settings.preset=t}}});var I=G,N=a("5f5b"),A=(a("f9e3"),a("2dd8"),a("c16e")),F=a.n(A);s["default"].use(N["a"]);let V={namespace:"camera__",name:"ls",storage:"local"};s["default"].use(F.a,V),s["default"].config.productionTip=!1,new s["default"]({router:H,store:I,render:e=>e(u)}).$mount("#app")},"64a9":function(e,t,a){},e04b:function(e,t,a){},ed39:function(e,t){},f5b4:function(e,t,a){"use strict";var s=a("e04b"),o=a.n(s);o.a}});
//# sourceMappingURL=app.b5dae761.js.map